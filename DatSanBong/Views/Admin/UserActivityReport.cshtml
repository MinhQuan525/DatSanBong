@{
    ViewBag.Title = ViewBag.ReportTitle ?? "Báo cáo Hoạt động Người dùng";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    :root {
        --primary: #2563eb;
        --success: #10b981;
        --warning: #f59e0b;
    }

    .report-header {
        margin-bottom: 30px;
    }

    .report-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 20px;
    }

    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .stat-label {
        font-size: 0.875rem;
        color: #64748b;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: #1e293b;
    }

    .chart-container {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .no-data {
        text-align: center;
        padding: 60px 20px;
        color: #64748b;
    }

    .no-data i {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
    }
</style>

<div class="report-header">
    <h1 class="report-title">
        <i class="fas fa-users"></i>
        @ViewBag.ReportTitle
    </h1>
</div>

@if (ViewBag.TotalUsers != null && ViewBag.ActiveUsers != null && ViewBag.AverageBookingsPerUser != null)
{
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-label">Tổng số người dùng</div>
            <div class="stat-value" style="color: var(--primary);">
                @ViewBag.TotalUsers
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Người dùng đã đặt sân</div>
            <div class="stat-value" style="color: var(--success);">
                @ViewBag.ActiveUsers
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Trung bình đặt sân/người</div>
            <div class="stat-value" style="color: var(--warning);">
                @ViewBag.AverageBookingsPerUser
            </div>
        </div>
    </div>
}

<div class="chart-container">
    @if (ViewBag.NewUserLabels != null && ViewBag.NewUserData != null)
    {
        <h3 style="margin-bottom: 20px; font-weight: 700;">Người dùng mới theo tháng</h3>
        <canvas id="newUsersChart" height="80"></canvas>
    }
    else
    {
        <div class="no-data">
            <i class="fas fa-user-plus"></i>
            <h3>Chưa có dữ liệu</h3>
            <p>Không có dữ liệu người dùng mới</p>
        </div>
    }
</div>

@section scripts {
    @if (ViewBag.NewUserLabels != null && ViewBag.NewUserData != null)
    {
        <script>
            $(document).ready(function() {
                var labels = @Html.Raw(ViewBag.NewUserLabels);
                var data = @Html.Raw(ViewBag.NewUserData);

                if (labels && data && labels.length > 0) {
                    var ctx = document.getElementById('newUsersChart').getContext('2d');
                    var newUsersChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Số người dùng mới',
                                data: data,
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                borderColor: 'rgba(37, 99, 235, 1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 4,
                                pointBackgroundColor: 'rgba(37, 99, 235, 1)',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Tháng',
                                        font: {
                                            size: 14,
                                            weight: 'bold'
                                        }
                                    },
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Số người dùng',
                                        font: {
                                            size: 14,
                                            weight: 'bold'
                                        }
                                    },
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return 'Người dùng mới: ' + context.parsed.y;
                                        }
                                    }
                                },
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
            });
        </script>
    }
}
