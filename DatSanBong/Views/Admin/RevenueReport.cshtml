@{
    ViewBag.Title = ViewBag.ReportTitle ?? "Báo cáo Doanh thu";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    :root {
        --primary: #2563eb;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
    }

    .report-header {
        margin-bottom: 30px;
    }

    .report-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 20px;
    }

    .period-selector {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
    }

    .btn-period {
        padding: 10px 20px;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 2px solid #e2e8f0;
        background: white;
        color: #64748b;
        text-decoration: none;
    }

    .btn-period:hover {
        border-color: var(--primary);
        color: var(--primary);
        transform: translateY(-2px);
        text-decoration: none;
    }

    .btn-period.active {
        background: linear-gradient(135deg, var(--primary), #3b82f6);
        border-color: var(--primary);
        color: white;
    }

    .stats-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .stat-label {
        font-size: 0.875rem;
        color: #64748b;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: #1e293b;
    }

    .chart-container {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .no-data {
        text-align: center;
        padding: 60px 20px;
        color: #64748b;
    }

    .no-data i {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
    }
</style>

<div class="report-header">
    <h1 class="report-title">@ViewBag.ReportTitle</h1>
    <div class="period-selector">
        <a href="@Url.Action("RevenueReport", new { period = "day" })" 
           class="btn-period @(ViewBag.CurrentPeriod == "day" ? "active" : "")">
            <i class="fas fa-calendar-day"></i> Theo ngày
        </a>
        <a href="@Url.Action("RevenueReport", new { period = "month" })" 
           class="btn-period @(ViewBag.CurrentPeriod == "month" ? "active" : "")">
            <i class="fas fa-calendar-alt"></i> Theo tháng
        </a>
        <a href="@Url.Action("RevenueReport", new { period = "year" })" 
           class="btn-period @(ViewBag.CurrentPeriod == "year" ? "active" : "")">
            <i class="fas fa-calendar"></i> Theo năm
        </a>
    </div>
</div>

@if (ViewBag.TotalRevenue != null && ViewBag.TotalBookings != null)
{
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-label">Tổng doanh thu</div>
            <div class="stat-value" style="color: var(--success);">
                @string.Format("{0:N0}", ViewBag.TotalRevenue) ₫
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Tổng số đơn</div>
            <div class="stat-value" style="color: var(--primary);">
                @ViewBag.TotalBookings
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-label">Doanh thu trung bình/đơn</div>
            <div class="stat-value" style="color: var(--warning);">
                @string.Format("{0:N0}", ViewBag.TotalBookings > 0 ? ViewBag.TotalRevenue / ViewBag.TotalBookings : 0) ₫
            </div>
        </div>
    </div>
}

<div class="chart-container">
    @if (ViewBag.Labels != null && ViewBag.Data != null)
    {
        <canvas id="revenueChart" height="80"></canvas>
    }
    else
    {
        <div class="no-data">
            <i class="fas fa-chart-bar"></i>
            <h3>Chưa có dữ liệu</h3>
            <p>Không có dữ liệu doanh thu trong kỳ được chọn</p>
        </div>
    }
</div>

@section scripts {
    @if (ViewBag.Labels != null && ViewBag.Data != null)
    {
        <script>
            $(document).ready(function() {
                var labels = @Html.Raw(ViewBag.Labels);
                var data = @Html.Raw(ViewBag.Data);

                if (labels && data && labels.length > 0) {
                    var ctx = document.getElementById('revenueChart').getContext('2d');
                    var revenueChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Doanh thu (VNĐ)',
                                data: data,
                                backgroundColor: 'rgba(37, 99, 235, 0.6)',
                                borderColor: 'rgba(37, 99, 235, 1)',
                                borderWidth: 2,
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            scales: {
                                x: {
                                    title: {
                                        display: true,
                                        text: '@ViewBag.XAxisLabel',
                                        font: {
                                            size: 14,
                                            weight: 'bold'
                                        }
                                    },
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Doanh thu (VNĐ)',
                                        font: {
                                            size: 14,
                                            weight: 'bold'
                                        }
                                    },
                                    ticks: {
                                        callback: function(value) {
                                            return value.toLocaleString('vi-VN') + ' ₫';
                                        }
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            var label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.y !== null) {
                                                label += context.parsed.y.toLocaleString('vi-VN') + ' ₫';
                                            }
                                            return label;
                                        }
                                    }
                                },
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
            });
        </script>
    }
}
